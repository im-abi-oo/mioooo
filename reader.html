<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" />
  <title>دوست دختر خانگی — Manga Reader</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazir-font@v30.1.0/dist/font-face.css" rel="stylesheet"/>
  <script src="https://unpkg.com/lucide@latest"></script>

  <style>
    :root {
      --bg: #050505;
      --accent: #a855f7;
      --panel: rgba(15, 15, 20, 0.96);
      --manga-w: 800px;
    }

    * { 
      box-sizing: border-box; 
      scrollbar-width: none; 
      user-select: none !important;
      -webkit-user-select: none !important;
      -webkit-touch-callout: none !important;
      -webkit-tap-highlight-color: transparent;
      outline: none;
    }
    *::-webkit-scrollbar { display: none; }

    html, body { height: 100%; width: 100%; }
    body { 
      background-color: var(--bg); 
      color: #fff; 
      font-family: 'Vazirmatn', sans-serif; 
      margin: 0;
      overflow: hidden;
    }

    /* --- فیلترهای اصلاح شده و قدرتمند --- */
    
    /* برجسته‌ساز خطوط (اصلاح شده): رنگ را نگه می‌دارد، کنتراست را شدید می‌کند */
    .f-lines { 
      filter: contrast(1.6) saturate(1.2) brightness(1.05) !important; 
    }
    
    /* سیاه و سفید: کنتراست بالا شبیه جوهر چاپ */
    .f-bw { 
      filter: grayscale(1) contrast(1.4) brightness(1.05) !important; 
    }
    
    /* محافظ چشم: گرم‌تر */
    .f-blue { 
      filter: sepia(0.3) hue-rotate(-20deg) contrast(0.95) brightness(0.9) !important; 
    }

    /* ترکیب خطوط + سیاه سفید */
    .f-lines.f-bw { 
      filter: grayscale(1) contrast(2.0) brightness(1.1) !important; 
    }

    /* --- کیفیت‌ها (بسیار قوی‌تر) --- */
    .q-sd { } /* اورجینال */
    
    /* HD: رنگ‌های زنده‌تر و کنتراست بهتر */
    .q-hd { 
      filter: contrast(1.15) saturate(1.4) brightness(1.03); 
      image-rendering: -webkit-optimize-contrast; 
    }
    
    /* UHD: نهایت شارپنس و رنگ (شبیه‌سازی HDR) */
    .q-uhd { 
      filter: contrast(1.25) saturate(1.6) brightness(1.08) drop-shadow(0 0 0.5px rgba(0,0,0,0.8)); 
    }

    .glass { 
      background: var(--panel); 
      backdrop-filter: blur(16px); 
      border: 1px solid rgba(255,255,255,0.08); 
    }

    /* کانتینر بدون فاصله */
    #render-area {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      width: 100%;
      padding-top: 90px;
      padding-bottom: 160px;
      gap: 0; 
      line-height: 0;
      font-size: 0;
    }
    
    .manga-page {
      display: flex;
      justify-content: center;
      width: 100%;
      max-width: var(--manga-w);
      position: relative;
      background: #000;
      margin: 0;
      padding: 0;
      line-height: 0;
      font-size: 0;
    }

    .manga-img {
      display: block;
      width: 100%;
      height: auto;
      opacity: 0;
      transition: opacity 0.3s ease;
      pointer-events: none;
      -webkit-user-drag: none;
      vertical-align: top;
      margin: 0;
      padding: 0;
      border: none;
      transform: translateZ(0);
    }

    .ui-anim { transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.4s ease; }
    .ui-hidden-t { transform: translateY(-120%); opacity: 0; }
    .ui-hidden-b { transform: translateY(120%); opacity: 0; }

    .btn-active {
      background: var(--accent) !important;
      color: white !important;
      box-shadow: 0 0 15px rgba(168, 85, 247, 0.6);
      border-color: var(--accent) !important;
    }

    input[type="range"] {
      -webkit-appearance: none;
      height: 6px;
      background: rgba(255,255,255,0.15);
      border-radius: 10px;
      direction: ltr;
    }
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 20px; height: 20px;
      background: var(--accent);
      border: 2px solid #fff;
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 0 10px rgba(0,0,0,0.5);
    }

    .en { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
  </style>
</head>
<body oncontextmenu="return false;">

  <header id="ui-header" class="fixed top-0 inset-x-0 z-[100] p-3 md:p-4 ui-anim">
    <div class="max-w-5xl mx-auto glass rounded-3xl px-4 py-3 flex items-center justify-between shadow-2xl">
      <div class="flex items-center gap-4 md:gap-5">
        <button onclick="goBack()" title="بازگشت" class="w-11 h-11 flex items-center justify-center rounded-2xl bg-white/5 hover:bg-white/10 transition-colors border border-white/5">
          <i data-lucide="arrow-right" class="w-5 h-5"></i>
        </button>
        <div class="flex flex-col justify-center">
          <p id="current-title" class="text-sm md:text-base font-bold truncate max-w-[180px] md:max-w-xs text-white">دوست دختر خانگی</p>
          <div class="flex items-center gap-2">
            <span class="text-[10px] font-black text-purple-500 uppercase tracking-wider bg-purple-500/10 px-1.5 rounded">چپتر <span id="ch-num-disp" class="en">1</span></span>
            <p id="current-title-en" class="text-[11px] text-zinc-400 en font-medium truncate max-w-[150px]">Domestic girlfriend</p>
          </div>
        </div>
      </div>
      
      <div class="flex items-center gap-3">
        <div class="hidden md:flex flex-col items-end px-4 border-l border-white/10">
            <span class="text-[9px] text-zinc-500 font-bold uppercase">صفحه</span>
            <div class="flex items-center gap-1 font-bold en text-sm">
                <span id="p-current" class="text-purple-400">01</span>
                <span class="text-zinc-600">/</span>
                <span id="p-total" class="text-zinc-500">--</span>
            </div>
        </div>
        <button onclick="event.stopPropagation(); togglePanel('panel-settings')" class="w-11 h-11 flex items-center justify-center rounded-2xl bg-purple-500/10 text-purple-400 border border-purple-500/30 hover:bg-purple-500/20 transition-all">
          <i data-lucide="settings-2" class="w-5 h-5"></i>
        </button>
      </div>
    </div>
  </header>

  <main id="scroller" class="w-full h-screen overflow-y-auto bg-black" onclick="toggleUI()">
    <div id="render-area"></div>
  </main>

  <footer id="ui-footer" class="fixed bottom-0 inset-x-0 z-[100] p-6 ui-anim pointer-events-none">
    <div class="max-w-xl mx-auto flex flex-col items-center gap-4">
        <div class="w-full h-1.5 bg-gray-800/60 rounded-full overflow-hidden pointer-events-auto backdrop-blur-sm border border-white/5">
            <div id="progress-bar" class="h-full bg-gradient-to-l from-purple-400 to-purple-600 transition-all duration-200 ease-out" style="width: 0%"></div>
        </div>
        
        <div class="glass px-1 py-1.5 rounded-[2.5rem] flex items-center gap-0.5 shadow-2xl pointer-events-auto">
            <button id="nav-next" class="w-12 h-12 flex items-center justify-center rounded-full text-zinc-400 hover:text-white hover:bg-white/5 transition-colors"><i data-lucide="chevron-right"></i></button>
            <div class="h-6 w-px bg-white/10 mx-1"></div>
            
            <button id="btn-auto" onclick="event.stopPropagation(); toggleAutoScroll()" class="w-12 h-12 flex items-center justify-center rounded-full text-zinc-400 hover:text-purple-400 hover:bg-white/5 transition-colors">
                <i data-lucide="play" id="play-icon" class="w-5 h-5 fill-current"></i>
            </button>
            <button onclick="event.stopPropagation(); togglePanel('panel-chapters')" class="w-12 h-12 flex items-center justify-center rounded-full text-zinc-400 hover:text-white hover:bg-white/5 transition-colors">
                <i data-lucide="list-start" class="w-5 h-5"></i>
            </button>
            <button onclick="event.stopPropagation(); toggleFullscreen()" class="w-12 h-12 flex items-center justify-center rounded-full text-zinc-400 hover:text-white hover:bg-white/5 transition-colors">
                <i data-lucide="maximize" class="w-5 h-5"></i>
            </button>
            <button onclick="event.stopPropagation(); scroller.scrollTo({top:0, behavior:'smooth'})" class="w-12 h-12 flex items-center justify-center rounded-full text-zinc-400 hover:text-white hover:bg-white/5 transition-colors">
                <i data-lucide="arrow-up-to-line" class="w-5 h-5"></i>
            </button>

            <div class="h-6 w-px bg-white/10 mx-1"></div>
            <button id="nav-prev" class="w-12 h-12 flex items-center justify-center rounded-full text-zinc-400 hover:text-white hover:bg-white/5 transition-colors"><i data-lucide="chevron-left"></i></button>
        </div>
    </div>
  </footer>

  <div id="panel-settings" class="fixed inset-0 z-[500] hidden items-center justify-center p-4 bg-black/90 backdrop-blur-md transition-opacity" onclick="togglePanel('panel-settings')">
    <div class="glass w-full max-w-sm p-6 rounded-[2rem] border border-white/10" onclick="event.stopPropagation()">
      <div class="flex justify-between items-center mb-6 border-b border-white/10 pb-4">
        <h3 class="text-lg font-bold flex items-center gap-2"><i data-lucide="sliders-horizontal" class="text-purple-500 w-5 h-5"></i> تنظیمات نمایش</h3>
        <button onclick="togglePanel('panel-settings')" class="w-8 h-8 flex items-center justify-center bg-white/5 rounded-full hover:bg-white/10"><i data-lucide="x" class="w-4 h-4"></i></button>
      </div>

      <div class="space-y-6">
        <div class="space-y-5">
            <div class="space-y-2">
                <div class="flex justify-between text-[11px] font-bold text-zinc-400"><span>اندازه تصویر</span> <span id="val-w" class="text-purple-400 en">800px</span></div>
                <input type="range" min="300" max="1600" step="50" id="range-w" class="w-full">
            </div>
            <div class="space-y-2">
                <div class="flex justify-between text-[11px] font-bold text-zinc-400"><span>سرعت اسکولر خودکار</span> <span id="val-s" class="text-purple-400 en">2.5x</span></div>
                <input type="range" min="0.5" max="15" step="0.5" id="range-s" class="w-full">
            </div>
        </div>

        <div class="space-y-2">
            <span class="text-[10px] font-black text-zinc-500 uppercase">فیلترها (چندانتخابی)</span>
            <div class="grid grid-cols-3 gap-2">
                <button id="btn-f-lines" onclick="toggleFilter('lines')" class="flex flex-col items-center gap-1.5 py-3 rounded-xl bg-white/5 text-[10px] font-bold border border-transparent transition-all hover:bg-white/10">
                    <i data-lucide="pencil" class="w-4 h-4 mb-0.5"></i>اصلاح کننده (ازمایشی)
                </button>
                <button id="btn-f-bw" onclick="toggleFilter('bw')" class="flex flex-col items-center gap-1.5 py-3 rounded-xl bg-white/5 text-[10px] font-bold border border-transparent transition-all hover:bg-white/10">
                    <i data-lucide="moon" class="w-4 h-4 mb-0.5"></i>سیاه و سفید(مانگا مود)
                </button>
                <button id="btn-f-blue" onclick="toggleFilter('blue')" class="flex flex-col items-center gap-1.5 py-3 rounded-xl bg-white/5 text-[10px] font-bold border border-transparent transition-all hover:bg-white/10">
                    <i data-lucide="eye" class="w-4 h-4 mb-0.5"></i>حالت شب
                </button>
            </div>
        </div>

        <div class="space-y-2">
            <span class="text-[10px] font-black text-zinc-500 uppercase">پردازش تصویر</span>
            <div class="grid grid-cols-3 gap-2">
                <button id="btn-q-sd" onclick="setQuality('sd')" class="py-2.5 rounded-lg bg-white/5 text-[11px] font-bold en border border-transparent transition-all">پیش فرض</button>
                <button id="btn-q-hd" onclick="setQuality('hd')" class="py-2.5 rounded-lg bg-white/5 text-[11px] font-bold en border border-transparent transition-all">HD (پیشنهادی)</button>
                <button id="btn-q-uhd" onclick="setQuality('uhd')" class="py-2.5 rounded-lg bg-white/5 text-[11px] font-bold en border border-transparent transition-all">UHD</button>
            </div>
        </div>

        <button onclick="resetSettings()" class="w-full py-3 rounded-xl bg-red-500/5 text-red-400 text-xs font-bold border border-red-500/10 hover:bg-red-500/15 transition-all flex items-center justify-center gap-2">
            <i data-lucide="rotate-ccw" class="w-3 h-3"></i> بازنشانی تنظیمات
        </button>
      </div>
    </div>
  </div>

  <aside id="panel-chapters" class="fixed inset-y-0 right-0 w-full md:w-80 glass z-[600] translate-x-full ui-anim flex flex-col md:rounded-r-none md:rounded-l-[2.5rem] border-l border-white/10 shadow-2xl">
    <div class="p-6 border-b border-white/5">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-lg font-bold flex items-center gap-2"><i data-lucide="library" class="text-purple-500 w-5 h-5"></i> فهرست چپترها</h3>
            <button onclick="togglePanel('panel-chapters')" class="w-8 h-8 flex items-center justify-center bg-white/5 rounded-full hover:bg-white/10"><i data-lucide="x" class="w-4 h-4"></i></button>
        </div>
        <div class="relative">
            <i data-lucide="search" class="absolute right-3 top-3 w-4 h-4 text-zinc-500"></i>
            <input type="text" id="chapter-search" placeholder="شماره چپتر..." class="w-full bg-black/30 border border-white/10 rounded-xl py-2.5 pr-10 pl-4 text-sm outline-none focus:border-purple-500 transition-colors">
        </div>
    </div>
    <div id="chapter-list" class="flex-1 overflow-y-auto p-4 space-y-2"></div>
  </aside>

  <script id="manga-db" type="application/json">{"titleFa": "دوست دختر خانگی", "titleEn": "Domestic girlfriend", "baseUrl": "https://cdn.jsdelivr.net/gh/im-abi-oo/mioooo@main/oo/", "backUrl": "./", "chapters": [{"chapterNumber": 83, "imageCount": 20}, {"chapterNumber": 85, "imageCount": 20}], "unlockLimit": 83}</script>

  <script>
    // DB
    const DB = (function(){
        try {
            const el = document.getElementById('manga-db');
            return JSON.parse(el.textContent);
        } catch (e) {
            console.error('DB Error:', e);
            return { titleFa: '', titleEn: '', baseUrl: '', unlockLimit: 0, chapters: [] };
        }
    })();

    let scroller = null;
    let userSettings = JSON.parse(localStorage.getItem('manga_pro_v3')) || { 
        width: 800, 
        speed: 2.5, 
        filter: { lines:false, bw:false, blue:false }, 
        quality: 'sd' 
    };
    let currentCh = 1;
    let isAuto = false, autoRaf = null, uiVisible = true;

    function pad(n,l=2){ return String(n).padStart(l,'0'); }

    function init(){
        scroller = document.getElementById('scroller');
        
        // Initial Chapter
        const hash = window.location.hash || '#ch-1';
        let requested = parseInt(hash.replace('#ch-','')) || 1;
        const available = DB.chapters.map(c=>c.chapterNumber).filter(n=>n<=DB.unlockLimit);
        
        if(available.length > 0 && !available.includes(requested)){
            requested = Math.min(...available);
        }
        currentCh = requested;

        // Title
        const enTitleEl = document.getElementById('current-title-en');
        if(enTitleEl) enTitleEl.textContent = DB.titleEn || '';

        renderChapter(currentCh);
        renderChapterList();
        applySettings();
        setupSecurity();
        lucide.createIcons();

        // Listeners
        window.addEventListener('hashchange', onHashChange);
        scroller.addEventListener('scroll', () => { requestAnimationFrame(updateProgress) }, { passive: true });
        
        document.getElementById('range-w').addEventListener('input', e => { 
            userSettings.width = Number(e.target.value); 
            applySettings(); 
        });
        document.getElementById('range-s').addEventListener('input', e => { 
            userSettings.speed = Number(e.target.value); 
            document.getElementById('val-s').textContent = userSettings.speed + 'x';
            saveSettings();
        });
        document.getElementById('chapter-search').addEventListener('input', e => renderChapterList(e.target.value.trim()));
        document.getElementById('nav-next').addEventListener('click', ()=>navChapter(1));
        document.getElementById('nav-prev').addEventListener('click', ()=>navChapter(-1));
    }

    function goBack(){
        if(DB.backUrl && DB.backUrl.length > 0){
            window.location.href = DB.backUrl;
            return;
        }
        window.location.href = './';
    }

    function onHashChange(){
        const num = parseInt((window.location.hash||'#ch-1').replace('#ch-','')) || 1;
        if(num === currentCh) return;
        if(num > DB.unlockLimit){
            window.location.hash = '#ch-' + currentCh;
            return;
        }
        currentCh = num;
        renderChapter(currentCh);
    }

    function renderChapter(num){
        const chapter = DB.chapters.find(c=>c.chapterNumber === num);
        if(!chapter) return;

        document.getElementById('ch-num-disp').textContent = num;
        
        const area = document.getElementById('render-area');
        while (area.firstChild) area.removeChild(area.firstChild);
        
        scroller.scrollTop = 0;
        document.getElementById('p-total').textContent = pad(chapter.imageCount || 0, 2);

        const fragment = document.createDocumentFragment();

        for(let i=1; i <= (chapter.imageCount||0); i++){
            const pageNum = String(i).padStart(3,'0');
            const url = `${DB.baseUrl}${num}/${pageNum}.webp`;

            const div = document.createElement('div');
            div.className = 'manga-page';

            const img = document.createElement('img');
            img.className = 'manga-img';
            img.alt = `Page ${i}`;
            img.dataset.src = url;
            img.src = 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxIiBoZWlnaHQ9IjEiPjwvc3ZnPg==';
            img.loading = 'lazy';

            updateImgClass(img);

            div.appendChild(img);
            fragment.appendChild(div);

            if(i <= 3) {
                loadImage(img);
            } else {
                observer.observe(div);
            }
        }
        area.appendChild(fragment);
        updateProgress();
    }

    function loadImage(img){
        if(!img.dataset.src) return;
        img.src = img.dataset.src;
        img.onload = () => img.style.opacity = '1';
        img.removeAttribute('data-src');
    }

    const observer = new IntersectionObserver(entries => {
        entries.forEach(entry => {
            if(entry.isIntersecting){
                const img = entry.target.querySelector('img');
                if(img && img.dataset.src) loadImage(img);
                
                const idx = Array.prototype.indexOf.call(entry.target.parentNode.children, entry.target) + 1;
                document.getElementById('p-current').textContent = pad(idx, 2);
                
                observer.unobserve(entry.target);
            }
        });
    }, { rootMargin: '1000px 0px' });

    function updateProgress(){
        const s = scroller;
        const progress = (s.scrollTop / (s.scrollHeight - s.clientHeight)) * 100;
        document.getElementById('progress-bar').style.width = Math.min(100, Math.max(0, progress)) + '%';
        
        const center = s.scrollTop + (window.innerHeight/2);
        const pages = document.getElementsByClassName('manga-page');
        for(let i=0; i<pages.length; i++){
            const el = pages[i];
            if(el.offsetTop <= center && (el.offsetTop + el.offsetHeight) > center){
                document.getElementById('p-current').textContent = pad(i+1, 2);
                break;
            }
        }
    }

    function renderChapterList(query=''){
        const list = document.getElementById('chapter-list');
        list.innerHTML = '';
        
        let chapters = DB.chapters.filter(c => c.chapterNumber <= DB.unlockLimit);
        chapters.sort((a,b) => b.chapterNumber - a.chapterNumber);

        if(query){
            const q = query.toLowerCase();
            chapters = chapters.filter(c => String(c.chapterNumber).includes(q));
        }

        if(chapters.length === 0){
            list.innerHTML = '<div class="text-center text-zinc-500 py-4 text-sm">موردی یافت نشد</div>';
            return;
        }

        chapters.forEach(ch => {
            const isActive = ch.chapterNumber === currentCh;
            const btn = document.createElement('button');
            btn.className = `w-full p-3 rounded-xl flex items-center justify-between text-sm transition-all mb-2 ${isActive 
                ? 'bg-purple-600 text-white shadow-lg shadow-purple-900/40' 
                : 'bg-white/5 text-zinc-400 hover:bg-white/10 hover:text-white'}`;
            
            btn.innerHTML = `
                <span class="font-bold flex items-center gap-2"><i data-lucide="file-image" class="w-4 h-4 opacity-70"></i> <span class="en">Chapter ${ch.chapterNumber}</span></span>
                <i data-lucide="${isActive ? 'check' : 'chevron-left'}" class="w-4 h-4"></i>
            `;
            btn.onclick = (e) => { 
                e.stopPropagation(); 
                if(!isActive) {
                    window.location.hash = `#ch-${ch.chapterNumber}`; 
                    togglePanel('panel-chapters');
                }
            };
            list.appendChild(btn);
        });
        lucide.createIcons();
    }

    function navChapter(dir){
        const sorted = DB.chapters.map(c=>c.chapterNumber).filter(n=>n<=DB.unlockLimit).sort((a,b)=>a-b);
        const currentIdx = sorted.indexOf(currentCh);
        const nextCh = sorted[currentIdx + dir];
        if(nextCh !== undefined) window.location.hash = `#ch-${nextCh}`;
    }

    function toggleFilter(key){
        userSettings.filter[key] = !userSettings.filter[key];
        applySettings();
    }

    function setQuality(q){
        userSettings.quality = q;
        applySettings();
    }

    function updateImgClass(img){
        const classes = ['manga-img'];
        if(userSettings.filter.lines) classes.push('f-lines');
        if(userSettings.filter.bw) classes.push('f-bw');
        if(userSettings.filter.blue) classes.push('f-blue');
        
        classes.push(userSettings.quality === 'sd' ? 'q-sd' : (userSettings.quality === 'hd' ? 'q-hd' : 'q-uhd'));
        img.className = classes.join(' ');
    }

    function applySettings(){
        document.documentElement.style.setProperty('--manga-w', userSettings.width + 'px');
        document.getElementById('val-w').textContent = userSettings.width + 'px';
        document.getElementById('range-w').value = userSettings.width;

        const imgs = document.querySelectorAll('.manga-img');
        imgs.forEach(updateImgClass);

        ['lines','bw','blue'].forEach(f => {
            const btn = document.getElementById(`btn-f-${f}`);
            if(btn) btn.classList.toggle('btn-active', userSettings.filter[f]);
        });
        ['sd','hd','uhd'].forEach(q => {
            const btn = document.getElementById(`btn-q-${q}`);
            if(btn) btn.classList.toggle('btn-active', userSettings.quality === q);
        });

        saveSettings();
    }

    function saveSettings(){
        localStorage.setItem('manga_pro_v3', JSON.stringify(userSettings));
    }

    function resetSettings(){
        userSettings = { width: 800, speed: 2.5, filter: { lines:false, bw:false, blue:false }, quality:'sd' };
        applySettings();
        document.getElementById('range-s').value = 2.5;
        document.getElementById('val-s').textContent = '2.5x';
    }

    function autoStep(){
        if(!isAuto) return;
        scroller.scrollBy({ top: userSettings.speed * 0.8, behavior: 'auto' });
        autoRaf = requestAnimationFrame(autoStep);
    }

    function toggleAutoScroll(){
        isAuto = !isAuto;
        const btn = document.getElementById('btn-auto');
        const icon = document.getElementById('play-icon');
        
        if(isAuto){
            autoRaf = requestAnimationFrame(autoStep);
            btn.classList.add('text-purple-400', 'bg-white/10');
            icon.setAttribute('data-lucide', 'pause');
            if(uiVisible) toggleUI();
        } else {
            cancelAnimationFrame(autoRaf);
            btn.classList.remove('text-purple-400', 'bg-white/10');
            icon.setAttribute('data-lucide', 'play');
        }
        lucide.createIcons();
    }

    // اصلاح شده: پشتیبانی قوی از تمام مرورگرها
    function toggleFullscreen(){
        const doc = window.document;
        const docEl = doc.documentElement;

        const requestFullScreen = docEl.requestFullscreen || docEl.mozRequestFullScreen || docEl.webkitRequestFullScreen || docEl.msRequestFullscreen;
        const cancelFullScreen = doc.exitFullscreen || doc.mozCancelFullScreen || doc.webkitExitFullscreen || doc.msExitFullscreen;

        if(!doc.fullscreenElement && !doc.mozFullScreenElement && !doc.webkitFullscreenElement && !doc.msFullscreenElement) {
            if(requestFullScreen) requestFullScreen.call(docEl);
        } else {
            if(cancelFullScreen) cancelFullScreen.call(doc);
        }
    }

    function togglePanel(id){
        const el = document.getElementById(id);
        if(id === 'panel-chapters') el.classList.toggle('translate-x-full');
        else {
            if(el.classList.contains('hidden')){
                el.classList.remove('hidden');
                el.classList.add('flex');
                setTimeout(()=>el.classList.remove('opacity-0'), 10);
            } else {
                el.classList.add('opacity-0');
                setTimeout(()=>{ el.classList.add('hidden'); el.classList.remove('flex'); }, 300);
            }
        }
    }

    function toggleUI(){
        if(isAuto) return;
        uiVisible = !uiVisible;
        document.getElementById('ui-header').classList.toggle('ui-hidden-t', !uiVisible);
        document.getElementById('ui-footer').classList.toggle('ui-hidden-b', !uiVisible);
        document.body.style.cursor = uiVisible ? 'default' : 'none';
    }

    function setupSecurity(){
        document.addEventListener('dragstart', e => e.preventDefault());
        document.addEventListener('keydown', e => {
            if(e.key === 'F12' || (e.ctrlKey && ['u','s','p'].includes(e.key.toLowerCase()))) e.preventDefault();
        });
    }

    window.onload = init;
  </script>
<script
  src="https://sentry.hamravesh.com/js-sdk-loader/0ffd45ee7183abc4332fe0ebc06da99b.min.js"
  crossorigin="anonymous"
></script>
</body>
</html>